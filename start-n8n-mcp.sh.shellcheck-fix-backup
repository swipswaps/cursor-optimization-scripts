#!/bin/bash

set -euo pipefail
# Automatic n8n-mcp container startup script
# Generated by n8n-mcp-docker-deployment

    local CONTAINER_NAME="n8n-mcp"
    local IMAGE_NAME="ghcr.io/czlonkowski/n8n-mcp:sha-df03d42"

echo "🚀 n8n-mcp Container Startup Service"
echo "Container: $CONTAINER_NAME"
echo "Image: $IMAGE_NAME"
echo

# Check if container is running
if docker ps --format "{{.Names}}" | grep -q "^"${CONTAINER_NAME}"$"; then
    echo "✅ n8n-mcp container is already running"
    docker ps | grep "$CONTAINER_NAME"
else
    echo "🔄 Starting n8n-mcp container..."

    # Remove stopped container if exists
    if docker ps -a --format "{{.Names}}" | grep -q "^"${CONTAINER_NAME}"$"; then
        echo "📋 Removing stopped container..."
        docker rm "$CONTAINER_NAME"
    fi

    # Start container with restart policy
    if docker run -d --name "$CONTAINER_NAME" -p 5678:5678 --restart unless-stopped "$IMAGE_NAME"; then
        echo "✅ n8n-mcp container started successfully"
        echo "🌐 Container accessible at: http://localhost:5678"
        echo "🔧 MCP integration ready for Augment Code"
    else
        echo "❌ Failed to start n8n-mcp container"
        exit 1
    fi
fi

echo
echo "📋 Container Status:"
docker ps | grep "$CONTAINER_NAME" || echo "Container not running"
echo
echo "💡 To stop container: docker stop $CONTAINER_NAME"
echo "💡 To restart container: docker restart $CONTAINER_NAME"
echo "💡 Container will auto-restart on system reboot"
